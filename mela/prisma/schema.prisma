// Bismillahirrahmanirahim
// Elhamdullillahirabbulalemin
// Es-selatu vesselamu ala rasulina Muhammedin 
// Allah u Ekber, Allah u Ekber, Allah u Ekber, La ilahe illallah
// La ilahe illallah
// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

// Add this enum
enum MediaType {
  IMAGE
  VIDEO
  OTHER
}

model User {
  id                    String         @id
  username              String         @unique
  displayName           String
  email                 String?        @unique
  passwordHash          String?
  googleId              String?        @unique
  avatarUrl             String?
  bio                   String?
  sessions              Session[]
  duyem                 Duyem[]
  hedis                 Hedis[]
  agahi                 Agahi[]        // <-- add this line
  bookmarks             Bookmark[]

  createdAt   DateTime      @default(now())
  Yekem       Yekem[]        // renamed relation (was Mmhewcedari)
  Dirok       Dirok[]
  Tefsir      Tefsir[]
  Meal        Meal[]
  Kelam       Kelam[]
  Fiqih       Fiqih[]
  @@map("users")
}

model Session {
  id        String   @id
  userId    String
  expiresAt DateTime
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}


model Agahi {
  id          String  @id @default(cuid())
  content     String[]
  userId      String
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  attachments Media[]

  bookmarks Bookmark[]

  createdAt           DateTime       @default(now())

  @@map("agahi")
}

model Duyem {
  id                  String         @id @default(cuid())
  content             String[]
  userId              String
  user                User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  attachments         Media[]
  bookmarks           Bookmark[]

  createdAt DateTime @default(now())

  @@map("duyem")
}

model Media {
  id     String    @id @default(cuid())
  postId String?
  post   Post?     @relation(fields: [postId], references: [id], onDelete: SetNull)
  type   MediaType
  url    String

  createdAt     DateTime     @default(now())
  Hedis         Hedis?       @relation(fields: [hedisId], references: [id])
  hedisId       String?
  Yekem         Yekem?       @relation(fields: [yekemId], references: [id])
  yekemId       String?
  Dirok         Dirok?       @relation(fields: [dirokId], references: [id])
  dirokId       String?
  Tefsir        Tefsir?      @relation(fields: [tefsirId], references: [id])
  tefsirId      String?
  Meal          Meal?        @relation(fields: [mealId], references: [id])
  mealId        String?
  Kelam         Kelam?       @relation(fields: [kelamId], references: [id])
  kelamId       String?
  Fiqih         Fiqih?       @relation(fields: [fiqihId], references: [id])
  fiqihId       String?
  Agahi         Agahi?       @relation(fields: [agahiId], references: [id])
  agahiId       String?

  @@map("post_media")
}

model Bookmark {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  postId String
  duyem  Duyem   @relation(fields: [postId], references: [id], onDelete: Cascade)

  createdAt     DateTime     @default(now())
  Hedis         Hedis?       @relation(fields: [hedisId], references: [id])
  hedisId       String?
  Yekem         Yekem?       @relation(fields: [yekemId], references: [id])
  yekemId       String?
  Dirok         Dirok?       @relation(fields: [dirokId], references: [id])
  dirokId       String?
  Tefsir        Tefsir?      @relation(fields: [tefsirId], references: [id])
  tefsirId      String?
  Meal          Meal?        @relation(fields: [mealId], references: [id])
  mealId        String?
  Kelam         Kelam?       @relation(fields: [kelamId], references: [id])
  kelamId       String?
  Fiqih         Fiqih?       @relation(fields: [fiqihId], references: [id])
  fiqihId       String?
  Agahi         Agahi?       @relation(fields: [agahiId], references: [id])
  agahiId       String?
}

// New renamed models (mapped to existing table names to preserve DB):
model Fiqih {
  id          String  @id @default(cuid())
  content     String[]
  userId      String
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  attachments Media[]
  bookmarks   Bookmark[]
  createdAt   DateTime @default(now())

  @@map("fiqih")
}

model Kelam {
  id          String  @id @default(cuid())
  content     String[]
  userId      String
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  attachments Media[]
  bookmarks   Bookmark[]
  createdAt   DateTime @default(now())

  @@map("kelam")
}

model Meal {
  id          String  @id @default(cuid())
  content     String[]
  userId      String
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  attachments Media[]
  bookmarks   Bookmark[]
  createdAt   DateTime @default(now())

  @@map("meal")
}

model Tefsir {
  id          String  @id @default(cuid())
  content     String[]
  userId      String
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  attachments Media[]
  bookmarks   Bookmark[]
  createdAt   DateTime @default(now())

  @@map("tefsir")
}

model Dirok {
  id          String  @id @default(cuid())
  content     String[]
  userId      String
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  attachments Media[]
  bookmarks   Bookmark[]
  createdAt   DateTime @default(now())

  @@map("dirok")
}

// ensure Hedis model exists
model Hedis {
  id          String  @id @default(cuid())
  content     String[]
  userId      String
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  attachments Media[]
  bookmarks   Bookmark[]
  createdAt   DateTime @default(now())

  @@map("hedis") // keep existing table name if needed; change if you want new table
}

// Yekem model (mapped to existing mmhewcedari table)
model Yekem {
  id          String  @id @default(cuid())
  content     String[]
  userId      String
  user        User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  attachments Media[]
  bookmarks   Bookmark[]
  createdAt   DateTime @default(now())

  @@map("yekem")
}
